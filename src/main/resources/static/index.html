<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>YES Germany - University Management</title>
    <style>
        body {
          margin: 0;
          padding: 0;
          font-family: "Segoe UI", sans-serif;
          background: #f0f2f5;
        }

        .container {
          max-width: 600px;
          margin: 40px auto;
          background: white;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
          text-align: center;
          color: #333;
        }

        form input, form select, form button {
          width: 100%;
          padding: 12px;
          margin: 10px 0;
          font-size: 16px;
          border: 1px solid #ccc;
          border-radius: 6px;
        }

        form button {
          background-color: #fbd105;
          font-weight: bold;
          cursor: pointer;
          transition: background 0.3s ease;
        }

        form button:hover {
          background-color: #e0bd00;
        }

        #universitySection {
          display: none;
        }

        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
        }

        th, td {
          padding: 12px;
          border-bottom: 1px solid #ccc;
          text-align: center;
        }

        .actions button {
          margin: 0 5px;
          padding: 6px 10px;
          border: none;
          border-radius: 4px;
          font-size: 14px;
          cursor: pointer;
        }

        .edit-btn {
          background-color: #007bff;
          color: white;
        }

        .delete-btn {
          background-color: #d60000;
          color: white;
        }

        .logout-btn {
          background: #333;
          color: white;
          float: right;
          margin-bottom: 10px;
        }

        .hidden {
          display: none;
        }
    </style>
</head>
<body>

<div class="container" id="authSection">
    <h2>Register</h2>
    <form id="registerForm">
        <input type="text" id="regUsername" placeholder="Username" required />
        <input type="password" id="regPassword" placeholder="Password" required />
        <button type="submit">Register</button>
    </form>

    <hr/>

    <h2>Login</h2>
    <form id="loginForm">
        <input type="text" id="loginUsername" placeholder="Username" required />
        <input type="password" id="loginPassword" placeholder="Password" required />
        <button type="submit">Login</button>
    </form>
</div>

<div class="container" id="universitySection">
    <h2>YES Germany - University Data</h2>
    <button class="logout-btn" onclick="logout()">Logout</button>

    <form id="universityForm">
        <input type="hidden" id="universityId">
        <input type="text" id="universityName" placeholder="University Name" required>
        <input type="text" id="courseName" placeholder="Course Name" required>
        <input type="url" id="courseLink" placeholder="Course Link" required>
        <select id="courseType" required>
            <option value="">Select Course Type</option>
            <option value="Bachelors">Bachelors</option>
            <option value="Masters">Masters</option>
            <option value="PhD">PhD</option>
        </select>
        <button type="submit">Save</button>
    </form>

    <table>
        <thead>
        <tr>
            <th>University</th>
            <th>Course</th>
            <th>Link</th>
            <th>Type</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="universityTable"></tbody>
    </table>
</div>

<script>
    const API = 'http://localhost:8080/api';

    const authSection = document.getElementById('authSection');
    const universitySection = document.getElementById('universitySection');
    const universityForm = document.getElementById('universityForm');
    const universityTable = document.getElementById('universityTable');

    // Register
    document.getElementById('registerForm').addEventListener('submit', async e => {
      e.preventDefault();
      const username = document.getElementById('regUsername').value;
      const password = document.getElementById('regPassword').value;

      const res = await fetch(`${API}/auth/register`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username, password })
      });

      if (res.ok) {
        alert("Registration successful! Please login.");
        e.target.reset();
      } else {
        alert("Registration failed.");
      }
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', async e => {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;

      const res = await fetch(`${API}/auth/login`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username, password })
      });

      if (res.ok) {
        const data = await res.json();
        localStorage.setItem('token', data.token);
        showUniversitySection();
      } else {
        alert("Login failed.");
      }
    });

    function logout() {
      localStorage.removeItem('token');
      universitySection.style.display = 'none';
      authSection.style.display = 'block';
      universityTable.innerHTML = '';
      universityForm.reset();
    }

    function showUniversitySection() {
      authSection.style.display = 'none';
      universitySection.style.display = 'block';
      loadUniversities();
    }

    async function loadUniversities() {
      const token = localStorage.getItem('token');
      const res = await fetch(`${API}/universities`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();

      universityTable.innerHTML = '';
      data.forEach(u => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${u.universityName}</td>
          <td>${u.courseName}</td>
          <td><a href="${u.courseLink}" target="_blank">View</a></td>
          <td>${u.courseType}</td>
          <td class="actions">
            <button class="edit-btn" onclick='editUniversity(${JSON.stringify(u)})'>Edit</button>
            <button class="delete-btn" onclick='deleteUniversity(${u.universityId})'>Delete</button>
          </td>
        `;
        universityTable.appendChild(row);
      });
    }

    universityForm.addEventListener('submit', async e => {
      e.preventDefault();
      const token = localStorage.getItem('token');
      const uni = {
        universityName: document.getElementById('universityName').value,
        courseName: document.getElementById('courseName').value,
        courseLink: document.getElementById('courseLink').value,
        courseType: document.getElementById('courseType').value
      };
      const id = document.getElementById('universityId').value;
      const method = id ? 'PUT' : 'POST';
      const url = id ? `${API}/universities/${id}` : `${API}/universities`;

      await fetch(url, {
        method,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(uni)
      });

      universityForm.reset();
      loadUniversities();
    });

    function editUniversity(u) {
      document.getElementById('universityId').value = u.universityId;
      document.getElementById('universityName').value = u.universityName;
      document.getElementById('courseName').value = u.courseName;
      document.getElementById('courseLink').value = u.courseLink;
      document.getElementById('courseType').value = u.courseType;
    }

    async function deleteUniversity(id) {
      const token = localStorage.getItem('token');
      if (confirm('Are you sure you want to delete this university?')) {
        await fetch(`${API}/universities/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        loadUniversities();
      }
    }

    // Auto-login check
    if (localStorage.getItem('token')) {
      showUniversitySection();
    }
</script>

</body>
</html>
